---
phase: 01-project-scaffold
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - PhoneMirror.sln
  - src/PhoneMirror/PhoneMirror.csproj
  - src/PhoneMirror/App.axaml
  - src/PhoneMirror/App.axaml.cs
  - src/PhoneMirror/Program.cs
  - src/PhoneMirror/ViewModels/MainWindowViewModel.cs
  - src/PhoneMirror/Views/MainWindow.axaml
  - src/PhoneMirror/Views/MainWindow.axaml.cs
  - src/PhoneMirror/ViewLocator.cs
  - src/PhoneMirror.Core/PhoneMirror.Core.csproj
autonomous: false
---

<objective>
Create new Avalonia solution with recommended stack: DI, ViewLocator, FluentAvaloniaUI dark theme.

Purpose: Establish cross-platform foundation for Phone Mirror using Avalonia UI
Output: Working solution that builds and launches with dark theme on all platforms
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/SUMMARY.md

Note: This is a greenfield Avalonia project. The existing WPF codebase (AdbMirror/) will be referenced for patterns in later phases but is NOT modified by this plan.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Avalonia solution structure</name>
  <files>PhoneMirror.sln, src/PhoneMirror/PhoneMirror.csproj, src/PhoneMirror.Core/PhoneMirror.Core.csproj, src/PhoneMirror/Program.cs, src/PhoneMirror/Views/MainWindow.axaml, src/PhoneMirror/Views/MainWindow.axaml.cs, src/PhoneMirror/ViewModels/MainWindowViewModel.cs</files>
  <action>
Create solution at repository root (alongside existing AdbMirror.sln):

1. Create `PhoneMirror.sln` with two projects:
   - `src/PhoneMirror/PhoneMirror.csproj` - Avalonia app
   - `src/PhoneMirror.Core/PhoneMirror.Core.csproj` - Class library for services

2. PhoneMirror.csproj:
   - Target: net8.0
   - OutputType: WinExe
   - Add packages: Avalonia (11.3.0+), Avalonia.Desktop, Avalonia.Themes.Fluent, FluentAvaloniaUI (2.4.0+), CommunityToolkit.Mvvm (8.4.0+), Microsoft.Extensions.DependencyInjection (8.0.0+)
   - Reference PhoneMirror.Core project

3. PhoneMirror.Core.csproj:
   - Target: net8.0
   - OutputType: Library
   - No additional packages yet (services added in Phase 2)

4. Create minimal startup:
   - Program.cs with Avalonia BuildAvaloniaApp() pattern
   - MainWindow.axaml with basic window (Title="Phone Mirror", Width=400, Height=600)
   - MainWindowViewModel.cs with empty class inheriting ObservableObject

Use CommunityToolkit.Mvvm source generators (partial classes, [ObservableProperty] ready).

AVOID: Do not use Avalonia.ReactiveUI - we're using CommunityToolkit.Mvvm per research recommendations.
  </action>
  <verify>
    dotnet restore PhoneMirror.sln
    dotnet build PhoneMirror.sln --configuration Debug
  </verify>
  <done>Solution builds without errors, contains two projects</done>
</task>

<task type="auto">
  <name>Task 2: Configure DI container and ViewLocator</name>
  <files>src/PhoneMirror/App.axaml.cs, src/PhoneMirror/ViewLocator.cs</files>
  <action>
1. Create ViewLocator.cs implementing IDataTemplate:
   - Match() returns true for ViewModelBase types
   - Build() resolves View by convention: FooViewModel â†’ FooView (in Views namespace)
   - Return TextBlock with "Not Found: {typeName}" for missing views

2. In App.axaml.cs:
   - Create ServiceCollection in constructor
   - Register MainWindowViewModel as singleton
   - Build ServiceProvider and store as static property (App.Services)
   - In OnFrameworkInitializationCompleted:
     - Get MainWindowViewModel from DI
     - Create MainWindow with DataContext set to ViewModel
     - Assign to ApplicationLifetime.MainWindow

3. Create base class src/PhoneMirror/ViewModels/ViewModelBase.cs:
   - Inherit from ObservableObject (CommunityToolkit.Mvvm)
   - Empty base for now (will add shared functionality later)

4. Update MainWindowViewModel to inherit ViewModelBase

Pattern: Constructor injection via Microsoft.Extensions.DI, not service locator.

AVOID: Do not use Splat (ReactiveUI's DI) - use Microsoft.Extensions.DI per research.
  </action>
  <verify>
    dotnet build src/PhoneMirror/PhoneMirror.csproj
    # Check ViewLocator.cs exists and contains IDataTemplate implementation
  </verify>
  <done>DI container configured, ViewLocator resolves ViewModels to Views</done>
</task>

<task type="auto">
  <name>Task 3: Configure FluentAvaloniaUI dark theme</name>
  <files>src/PhoneMirror/App.axaml</files>
  <action>
1. Update App.axaml to use FluentAvaloniaUI:
   - Add FluentAvaloniaUI namespace: xmlns:ui="using:FluentAvalonia.Styling"
   - Replace Avalonia.Themes.Fluent with FluentAvaloniaTheme
   - Set RequestedTheme="Dark" (matches Lab visual identity - UX-01)

2. App.axaml structure:
```xml
<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:PhoneMirror"
             x:Class="PhoneMirror.App">
    <Application.DataTemplates>
        <local:ViewLocator/>
    </Application.DataTemplates>
    <Application.Styles>
        <FluentAvaloniaTheme RequestedTheme="Dark" />
    </Application.Styles>
</Application>
```

3. Update MainWindow.axaml for FluentAvalonia:
   - Use ui:FABorder or standard controls (FluentAvalonia styles them automatically)
   - Add simple content: TextBlock with "Phone Mirror" centered
   - Set Background="{DynamicResource ApplicationBackgroundBrush}" on window

AVOID: Do not use Avalonia.Themes.Fluent (built-in) - use FluentAvaloniaUI for better Windows 11 styling.
  </action>
  <verify>
    dotnet build src/PhoneMirror/PhoneMirror.csproj
  </verify>
  <done>App.axaml configured with FluentAvaloniaUI dark theme</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Avalonia application with FluentAvaloniaUI dark theme</what-built>
  <how-to-verify>
    1. Run: dotnet run --project src/PhoneMirror/PhoneMirror.csproj
    2. Window appears titled "Phone Mirror"
    3. Dark theme is applied (dark background, light text)
    4. Window is resizable and closeable
    5. Close window - app exits cleanly
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `dotnet build PhoneMirror.sln` succeeds without errors
- [ ] `dotnet run --project src/PhoneMirror/PhoneMirror.csproj` launches app
- [ ] Dark theme visible (not default light theme)
- [ ] Window closes cleanly without exceptions
</verification>

<success_criteria>
- All tasks completed
- Solution builds on first try
- App launches with dark FluentAvalonia theme
- DI container resolves MainWindowViewModel
- ViewLocator pattern in place
- Ready for Phase 2 service migration
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-scaffold/01-01-SUMMARY.md`
</output>
