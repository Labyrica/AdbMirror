<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PhoneMirror.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="420" d:DesignHeight="560"
        x:Class="PhoneMirror.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Phone Mirror"
        Width="420"
        SizeToContent="Height"
        MinWidth="420"
        MaxWidth="600"
        CanResize="True"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource LabyricaBackgroundBrush}">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <!-- Main layout -->
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with logo and action buttons -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Logo and title -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                <Image Source="/Assets/labyrica-logo.png"
                       Height="14"
                       VerticalAlignment="Center"
                       Opacity="0.7"/>
                <TextBlock Text="PHONE MIRROR"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource LabyricaTextPrimaryBrush}"
                           LetterSpacing="2"
                           Margin="10,0,0,0"
                           VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Action buttons -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8">
                <Button Width="36" Height="36"
                        Background="{StaticResource LabyricaSurfaceBrush}"
                        BorderBrush="{StaticResource LabyricaBorderPrimaryBrush}"
                        BorderThickness="1"
                        CornerRadius="3"
                        Padding="0"
                        ToolTip.Tip="Logs"
                        Command="{Binding ToggleLogsCommand}">
                    <TextBlock Text="&#xE7BA;"
                               FontFamily="{StaticResource SymbolThemeFontFamily}"
                               FontSize="16"
                               Foreground="{StaticResource LabyricaTextPrimaryBrush}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Button>
                <Button Width="36" Height="36"
                        Background="{StaticResource LabyricaSurfaceBrush}"
                        BorderBrush="{StaticResource LabyricaBorderPrimaryBrush}"
                        BorderThickness="1"
                        CornerRadius="3"
                        Padding="0"
                        ToolTip.Tip="Settings"
                        Command="{Binding ToggleSettingsCommand}">
                    <TextBlock Text="&#xE713;"
                               FontFamily="{StaticResource SymbolThemeFontFamily}"
                               FontSize="16"
                               Foreground="{StaticResource LabyricaTextPrimaryBrush}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Settings Panel (collapsible) -->
        <Border Grid.Row="1"
                Background="{StaticResource LabyricaSurfaceBrush}"
                BorderBrush="{StaticResource LabyricaBorderPrimaryBrush}"
                BorderThickness="1"
                CornerRadius="3"
                Padding="16,12"
                Margin="0,0,0,12"
                IsVisible="{Binding IsSettingsVisible}">
            <StackPanel Spacing="12">
                <TextBlock Text="SETTINGS"
                           FontSize="10"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                           LetterSpacing="1"/>

                <!-- ADB Path -->
                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0"
                               Text="ADB Path"
                               FontSize="11"
                               Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Width="80"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding AdbPath}"
                             FontSize="11"
                             IsReadOnly="True"/>
                </Grid>

                <!-- Scrcpy Path -->
                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0"
                               Text="Scrcpy Path"
                               FontSize="11"
                               Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Width="80"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding ScrcpyPath}"
                             FontSize="11"
                             IsReadOnly="True"/>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Main Card -->
        <Border Grid.Row="2"
                Background="{StaticResource LabyricaSurfaceBrush}"
                BorderBrush="{StaticResource LabyricaBorderPrimaryBrush}"
                BorderThickness="1"
                CornerRadius="3"
                Padding="24,20">
            <StackPanel>

                <!-- Status Badge -->
                <Border Background="{StaticResource LabyricaBackgroundBrush}"
                        CornerRadius="2"
                        Padding="12,8"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="6" Height="6"
                                 Fill="{StaticResource LabyricaSuccessBrush}"
                                 Margin="0,0,8,0"
                                 VerticalAlignment="Center"
                                 IsVisible="{Binding IsPrimaryEnabled}"/>
                        <Ellipse Width="6" Height="6"
                                 Fill="{StaticResource LabyricaWarningBrush}"
                                 Margin="0,0,8,0"
                                 VerticalAlignment="Center"
                                 IsVisible="{Binding !IsPrimaryEnabled}"/>
                        <TextBlock Text="{Binding StatusText}"
                                   FontSize="11"
                                   Foreground="{StaticResource LabyricaTextAccentBrush}"
                                   VerticalAlignment="Center"
                                   MaxWidth="240"
                                   TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Border>

                <!-- Device Name -->
                <TextBlock Text="{Binding DeviceDisplayName}"
                           FontSize="20"
                           FontWeight="Medium"
                           Foreground="{StaticResource LabyricaTextPrimaryBrush}"
                           HorizontalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Margin="0,0,0,24"/>

                <!-- Mirror Button -->
                <Button Height="52"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Command="{Binding MirrorCommand}"
                        IsEnabled="{Binding IsPrimaryEnabled}"
                        Classes="labyrica-primary"
                        Margin="0,0,0,20">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="&#xE768;"
                                   FontFamily="{StaticResource SymbolThemeFontFamily}"
                                   FontSize="16"
                                   Margin="0,0,10,0"
                                   VerticalAlignment="Center"
                                   Foreground="Black"/>
                        <TextBlock Text="{Binding PrimaryButtonText}"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   Foreground="Black"
                                   LetterSpacing="1"/>
                    </StackPanel>
                </Button>

                <!-- Divider -->
                <Border Height="1"
                        Background="{StaticResource LabyricaBorderPrimaryBrush}"
                        Margin="0,0,0,16"/>

                <!-- Quality Row -->
                <Grid ColumnDefinitions="Auto,*" Margin="0,0,0,16">
                    <TextBlock Grid.Column="0"
                               Text="Quality"
                               FontSize="11"
                               Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding Presets}"
                              SelectedItem="{Binding SelectedPreset}"
                              HorizontalAlignment="Stretch"/>
                </Grid>

                <!-- Options -->
                <StackPanel Orientation="Vertical" Spacing="10">
                    <CheckBox Content="Auto-mirror on connect"
                              IsChecked="{Binding AutoMirrorOnConnect}"
                              FontSize="11"
                              Foreground="{StaticResource LabyricaTextPrimaryBrush}"/>
                    <CheckBox Content="Start fullscreen"
                              IsChecked="{Binding StartFullscreen}"
                              FontSize="11"
                              Foreground="{StaticResource LabyricaTextPrimaryBrush}"/>
                    <CheckBox Content="Keep screen awake"
                              IsChecked="{Binding KeepScreenAwake}"
                              FontSize="11"
                              Foreground="{StaticResource LabyricaTextPrimaryBrush}"/>
                </StackPanel>

            </StackPanel>
        </Border>

        <!-- Logs Panel (collapsible) -->
        <Border Grid.Row="3"
                Background="{StaticResource LabyricaSurfaceBrush}"
                BorderBrush="{StaticResource LabyricaBorderPrimaryBrush}"
                BorderThickness="1"
                CornerRadius="3"
                Padding="12"
                Margin="0,12,0,0"
                Height="180"
                IsVisible="{Binding IsLogsVisible}">
            <Grid RowDefinitions="Auto,*">
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <TextBlock Text="LOGS"
                               FontSize="10"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                               LetterSpacing="1"/>
                    <Button HorizontalAlignment="Right"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="4"
                            Command="{Binding ClearLogsCommand}">
                        <TextBlock Text="Clear"
                                   FontSize="10"
                                   Foreground="{StaticResource LabyricaTextSecondaryBrush}"/>
                    </Button>
                </Grid>
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding LogMessages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}"
                                           FontSize="10"
                                           FontFamily="Consolas"
                                           Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,1"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Footer -->
        <StackPanel Grid.Row="4"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,0">
            <TextBlock Text="labyrica.com"
                       FontSize="10"
                       Foreground="{StaticResource LabyricaTextSecondaryBrush}"
                       Opacity="0.5"/>
        </StackPanel>
    </Grid>

</Window>
